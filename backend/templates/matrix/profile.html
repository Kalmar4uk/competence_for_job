{% extends "index.html" %}
{% block title %}
  {{ user.first_name }} {{ user.last_name }}
{% endblock %}
{% block content %}
  <p>{{ user.first_name }} {{ user.last_name }}</p>
  <p>{{ user.job_title }}</p>
  <p>{{ user.group }}</p>
  <p>Табельный номер: {% if user.personnel_number|slice:":1" == "0" %}{{ user.personnel_number|slice:"1:" }}{% else %}{{ user.personnel_number }}{% endif %}</p>

  Общая оценка компенции для твоей должности:
  <p>{{ general_sum_grade }}</p>

  Твоя оценка в этом месяце:
  <p>{{ personal_sum_grade }} {% if general_sum_grade <= personal_sum_grade or general_sum_grade is None %}&#129321;{% else %}&#128542;{% endif %}</p>

  {% if not personal_competence_grade %}
    <p>Нет пройденной матрицы или все навыки с оценкой 0</p>
  {% else %}
    {% if competence_with_grade_zero %}
      <p>Компетенции по которым отсутствует навык:</p>
        {% for competence in competence_with_grade_zero %}
          <p>{{ competence.skill__skill }}</p>
        {% endfor %}
    {% else %}
      <p>Навыков с оценкой 0 нет, красавелла &#128077;</p>
    {% endif %}
    <details>
      <summary>Уровень компетенций за текущий месяц</summary>
      <table>
        <tr>
          <td>Навык</td>
          <td>Оценка</td>
        </tr>
        {% for competence in personal_competence_grade %}
          <tr>
            <td>{{ competence.skill__skill }}</td>
            <td>{{ competence.grade_skill__grade }}</td>
          </tr>
        {% endfor %}
      </table>
    </details>
  {% endif %}
  {% if old_personal_competence %}
    <details>
      <summary>Ранее пройденные компетенции за последние 3 месяца</summary>
      {% for competence in old_personal_competence %}
        <details>
        <summary>{{ competence.created_at|date:"d.m.y" }}</summary>
        <p>Оценка: {{ competence.sum_grade }} {% if general_sum_grade <= competence.sum_grade or general_sum_grade is None %}&#129321;{% else %}&#128542;{% endif %}</p>
        </details>
      {% endfor %}
    </details>
  {% endif %}
  {% if general_sum_grade and request.user == user and not check_passing %}
    <a href="{% url 'matrix:matrix' %}">Пройти матрицу</a>
  {% endif %}
{% endblock %}